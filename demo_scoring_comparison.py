import pandas as pd
import os
from core.processor import check_student_answers, create_check_result_word
from datetime import datetime

def create_scoring_comparison_demo():
    """
    –°—Ç–≤–æ—Ä—é—î –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—é —Ä—ñ–∑–Ω–∏—Ö –ø—ñ–¥—Ö–æ–¥—ñ–≤ –¥–æ –æ—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è —Å–∫–ª–∞–¥–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å.
    """
    print("=== –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è —Å–∏—Å—Ç–µ–º–∏ —á–∞—Å—Ç–∫–æ–≤–æ–≥–æ –æ—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è ===")
    
    # –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ
    test_data = {
        '–í–∞—Ä—ñ–∞–Ω—Ç': [1],
        '–í—ñ–¥–ø–æ–≤—ñ–¥—ñ': ['–ê–í–î–ñ–ò,–ë,–í'],  # –°–∫–ª–∞–¥–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è + 2 –ø—Ä–æ—Å—Ç—ñ
        '–í–∞–≥–∏': ['5,1,1']  # –°–∫–ª–∞–¥–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è –º–∞—î –±—ñ–ª—å—à—É –≤–∞–≥—É
    }
    
    detailed_data = [
        {
            '–í–∞—Ä—ñ–∞–Ω—Ç': 1,
            '–ù–æ–º–µ—Ä_–ø–∏—Ç–∞–Ω–Ω—è': 1,
            '–¢–µ–∫—Å—Ç_–ø–∏—Ç–∞–Ω–Ω—è': '–û–±–µ—Ä—ñ—Ç—å –≤—Å—ñ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ —Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø—Ä–æ —Ñ–æ—Ç–æ—Å–∏–Ω—Ç–µ–∑:',
            '–¢–∏–ø_–ø–∏—Ç–∞–Ω–Ω—è': '–¢–µ—Å—Ç–æ–≤–µ',
            '–ü—Ä–∞–≤–∏–ª—å–Ω–∞_–≤—ñ–¥–ø–æ–≤—ñ–¥—å': '–ê–í–î–ñ–ò',
            '–í–∞–≥–∞': 5,
            '–í–∞—Ä—ñ–∞–Ω—Ç_1': '–ê) –í—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –≤ —Ö–ª–æ—Ä–æ–ø–ª–∞—Å—Ç–∞—Ö',
            '–í–∞—Ä—ñ–∞–Ω—Ç_2': '–ë) –ü–æ—Ç—Ä–µ–±—É—î —Ç—ñ–ª—å–∫–∏ –≤–æ–¥–∏',
            '–í–∞—Ä—ñ–∞–Ω—Ç_3': '–í) –í–∏–¥—ñ–ª—è—î –∫–∏—Å–µ–Ω—å',
            '–í–∞—Ä—ñ–∞–Ω—Ç_4': '–ì) –í—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –≤–¥–µ–Ω—å',
            '–í–∞—Ä—ñ–∞–Ω—Ç_5': '–î) –ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î CO‚ÇÇ –Ω–∞ –≥–ª—é–∫–æ–∑—É',
            '–í–∞—Ä—ñ–∞–Ω—Ç_6': '–ï) –ü–æ—Ç—Ä–µ–±—É—î —Å–≤—ñ—Ç–ª–∞',
            '–í–∞—Ä—ñ–∞–Ω—Ç_7': '–ñ) –í—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –≤ –º—ñ—Ç–æ—Ö–æ–Ω–¥—Ä—ñ—è—Ö',
            '–í–∞—Ä—ñ–∞–Ω—Ç_8': '–ó) –°–ø–æ–∂–∏–≤–∞—î –∫–∏—Å–µ–Ω—å',
            '–í–∞—Ä—ñ–∞–Ω—Ç_9': '–ò) –°—Ç–≤–æ—Ä—é—î –æ—Ä–≥–∞–Ω—ñ—á–Ω—ñ —Ä–µ—á–æ–≤–∏–Ω–∏'
        },
        {
            '–í–∞—Ä—ñ–∞–Ω—Ç': 1,
            '–ù–æ–º–µ—Ä_–ø–∏—Ç–∞–Ω–Ω—è': 2,
            '–¢–µ–∫—Å—Ç_–ø–∏—Ç–∞–Ω–Ω—è': '–Ø–∫–∞ —Ñ–æ—Ä–º—É–ª–∞ –≤–æ–¥–∏?',
            '–¢–∏–ø_–ø–∏—Ç–∞–Ω–Ω—è': '–¢–µ—Å—Ç–æ–≤–µ',
            '–ü—Ä–∞–≤–∏–ª—å–Ω–∞_–≤—ñ–¥–ø–æ–≤—ñ–¥—å': '–ë',
            '–í–∞–≥–∞': 1,
            '–í–∞—Ä—ñ–∞–Ω—Ç_1': '–ê) H‚ÇÇSO‚ÇÑ',
            '–í–∞—Ä—ñ–∞–Ω—Ç_2': '–ë) H‚ÇÇO'
        },
        {
            '–í–∞—Ä—ñ–∞–Ω—Ç': 1,
            '–ù–æ–º–µ—Ä_–ø–∏—Ç–∞–Ω–Ω—è': 3,
            '–¢–µ–∫—Å—Ç_–ø–∏—Ç–∞–Ω–Ω—è': '–°–∫—ñ–ª—å–∫–∏ —Ö—Ä–æ–º–æ—Å–æ–º —É –ª—é–¥–∏–Ω–∏?',
            '–¢–∏–ø_–ø–∏—Ç–∞–Ω–Ω—è': '–¢–µ—Å—Ç–æ–≤–µ',
            '–ü—Ä–∞–≤–∏–ª—å–Ω–∞_–≤—ñ–¥–ø–æ–≤—ñ–¥—å': '–í',
            '–í–∞–≥–∞': 1,
            '–í–∞—Ä—ñ–∞–Ω—Ç_1': '–ê) 44',
            '–í–∞—Ä—ñ–∞–Ω—Ç_2': '–ë) 45',
            '–í–∞—Ä—ñ–∞–Ω—Ç_3': '–í) 46'
        }
    ]
    
    # –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–∏–º—á–∞—Å–æ–≤–∏–π Excel —Ñ–∞–π–ª
    timestamp = datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
    test_file = f'demo_scoring_{timestamp}.xlsx'
    
    with pd.ExcelWriter(test_file, engine='openpyxl') as writer:
        pd.DataFrame(test_data).to_excel(writer, sheet_name='–û—Å–Ω–æ–≤–Ω—ñ_–≤—ñ–¥–ø–æ–≤—ñ–¥—ñ', index=False)
        pd.DataFrame(detailed_data).to_excel(writer, sheet_name='–î–µ—Ç–∞–ª—å–Ω–∞_—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è', index=False)
    
    print(f"–°—Ç–≤–æ—Ä–µ–Ω–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ–π–Ω–∏–π —Ñ–∞–π–ª: {test_file}")
    
    # –†—ñ–∑–Ω—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π —É—á–Ω—ñ–≤
    scenarios = [
        {
            'name': '–í—ñ–¥–º—ñ–Ω–Ω–∏–∫ –û–ª–µ–∫—Å—ñ–π',
            'description': '–ó–Ω–∞—î –≤—Å–µ —ñ–¥–µ–∞–ª—å–Ω–æ',
            'answers': ['–ê–í–î–ñ–ò', '–ë', '–í'],
            'color': '–∑–µ–ª–µ–Ω–∏–π'
        },
        {
            'name': '–•–æ—Ä–æ—à–∏—Å—Ç –ú–∞—Ä—ñ—è',
            'description': '–ó–Ω–∞—î –º–∞–π–∂–µ –≤—Å–µ, –∞–ª–µ –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∞ –æ–¥–Ω—É –¥–µ—Ç–∞–ª—å',
            'answers': ['–ê–í–î–ñ', '–ë', '–í'],  # –ü—Ä–æ–ø—É—Å—Ç–∏–ª–∞ –ò
            'color': '—Å–≤—ñ—Ç–ª–æ-–∑–µ–ª–µ–Ω–∏–π'
        },
        {
            'name': '–°–µ—Ä–µ–¥–Ω—è–∫ –ü–µ—Ç—Ä–æ',
            'description': '–ó–Ω–∞—î –æ—Å–Ω–æ–≤–∏, –∞–ª–µ –ø–ª—É—Ç–∞—î—Ç—å—Å—è –≤ –¥–µ—Ç–∞–ª—è—Ö',
            'answers': ['–ê–í–ë', '–ë', '–í'],  # –ê,–í –ø—Ä–∞–≤–∏–ª—å–Ω—ñ, –ë - –ø–æ–º–∏–ª–∫–∞
            'color': '–∂–æ–≤—Ç–∏–π'
        },
        {
            'name': '–°–ª–∞–±–∫–∏–π –Ü–≤–∞–Ω',
            'description': '–ó–Ω–∞—î –º–∞–ª–æ, –±–∞–≥–∞—Ç–æ –ø–æ–º–∏–ª–æ–∫',
            'answers': ['–ê–ë–ó', '–ê', '–ê'],  # –¢—ñ–ª—å–∫–∏ –ê –ø—Ä–∞–≤–∏–ª—å–Ω–∞ –≤ —Å–∫–ª–∞–¥–Ω–æ–º—É –∑–∞–≤–¥–∞–Ω–Ω—ñ
            'color': '–ø–æ–º–∞—Ä–∞–Ω—á–µ–≤–∏–π'
        },
        {
            'name': '–ù–µ–≤—Å—Ç–∏–≥–∞—é—á–∏–π –°–µ—Ä–≥—ñ–π',
            'description': '–í—ñ–¥–ø–æ–≤—ñ–¥–∞–≤ –Ω–∞–≤–º–∞–Ω–Ω—è',
            'answers': ['–ë–ó–ö', '–ê', '–ê'],  # –í—Å—ñ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ
            'color': '—á–µ—Ä–≤–æ–Ω–∏–π'
        }
    ]
    
    print("\n=== –ü–û–†–Ü–í–ù–Ø–ù–ù–Ø –°–ò–°–¢–ï–ú –û–¶–Ü–ù–Æ–í–ê–ù–ù–Ø ===")
    print("\n–ü—Ä–∞–≤–∏–ª—å–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:")
    print("1. –ê–í–î–ñ–ò (—Å–∫–ª–∞–¥–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è, 5 –±–∞–ª—ñ–≤)")
    print("2. –ë (–ø—Ä–æ—Å—Ç–µ –∑–∞–≤–¥–∞–Ω–Ω—è, 1 –±–∞–ª)")
    print("3. –í (–ø—Ä–æ—Å—Ç–µ –∑–∞–≤–¥–∞–Ω–Ω—è, 1 –±–∞–ª)")
    print("\n–ú–∞–∫—Å–∏–º—É–º: 12 –±–∞–ª—ñ–≤")
    
    print("\n" + "="*80)
    print(f"{'–£—á–µ–Ω—å':<20} {'–í—ñ–¥–ø–æ–≤—ñ–¥—ñ':<15} {'–ù–æ–≤–∞ —Å–∏—Å—Ç–µ–º–∞':<15} {'–°—Ç–∞—Ä–∞ —Å–∏—Å—Ç–µ–º–∞':<15} {'–†—ñ–∑–Ω–∏—Ü—è':<10}")
    print("="*80)
    
    for scenario in scenarios:
        try:
            # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∑ –Ω–æ–≤–æ—é —Å–∏—Å—Ç–µ–º–æ—é
            result = check_student_answers(test_file, 1, scenario['answers'])
            new_score = result['weighted_score']
            new_percent = result['score_percentage']
            
            # –°–∏–º—É–ª—é—î–º–æ —Å—Ç–∞—Ä—É —Å–∏—Å—Ç–µ–º—É (–±—ñ–Ω–∞—Ä–Ω–µ –æ—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è)
            old_score = 0
            if scenario['answers'][0] == '–ê–í–î–ñ–ò':  # –°–∫–ª–∞–¥–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è
                old_score += 5 * (12/7)  # 5 –±–∞–ª—ñ–≤ –∑ 7 –∑–∞–≥–∞–ª—å–Ω–æ—ó –≤–∞–≥–∏
            if scenario['answers'][1] == '–ë':  # –ü—Ä–æ—Å—Ç–µ –∑–∞–≤–¥–∞–Ω–Ω—è
                old_score += 1 * (12/7)
            if scenario['answers'][2] == '–í':  # –ü—Ä–æ—Å—Ç–µ –∑–∞–≤–¥–∞–Ω–Ω—è
                old_score += 1 * (12/7)
            
            difference = new_score - old_score
            
            answers_str = ','.join(scenario['answers'])
            
            print(f"{scenario['name']:<20} {answers_str:<15} {new_score:>6.1f}–± ({new_percent:>4.1f}%) {old_score:>6.1f}–± ({old_score/12*100:>4.1f}%) {difference:>+6.1f}–±")
            
        except Exception as e:
            print(f"{scenario['name']:<20} –ü–û–ú–ò–õ–ö–ê: {e}")
    
    print("="*80)
    
    # –°—Ç–≤–æ—Ä—é—î–º–æ –¥–µ—Ç–∞–ª—å–Ω—ñ –∑–≤—ñ—Ç–∏ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó
    print("\n=== –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–µ—Ç–∞–ª—å–Ω–∏—Ö –∑–≤—ñ—Ç—ñ–≤ ===")
    
    output_dir = "demo_output"
    os.makedirs(output_dir, exist_ok=True)
    
    for scenario in scenarios:
        try:
            result = check_student_answers(test_file, 1, scenario['answers'])
            
            # –°—Ç–≤–æ—Ä—é—î–º–æ Word –∑–≤—ñ—Ç
            doc_path = create_check_result_word(result, output_dir)
            
            print(f"–°—Ç–≤–æ—Ä–µ–Ω–æ –∑–≤—ñ—Ç –¥–ª—è {scenario['name']}: {os.path.basename(doc_path)}")
            
        except Exception as e:
            print(f"–ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–≤—ñ—Ç—É –¥–ª—è {scenario['name']}: {e}")
    
    # –í–∏–¥–∞–ª—è—î–º–æ —Ç–∏–º—á–∞—Å–æ–≤–∏–π —Ñ–∞–π–ª
    try:
        os.remove(test_file)
        print(f"\n–í–∏–¥–∞–ª–µ–Ω–æ —Ç–∏–º—á–∞—Å–æ–≤–∏–π —Ñ–∞–π–ª: {test_file}")
    except:
        pass
    
    print("\n=== –í–ò–°–ù–û–í–ö–ò ===")
    print("\n‚úÖ –ü–ï–†–ï–í–ê–ì–ò –ù–û–í–û–á –°–ò–°–¢–ï–ú–ò:")
    print("‚Ä¢ –°–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ñ—à–µ –æ—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è —Å–∫–ª–∞–¥–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å")
    print("‚Ä¢ –ß–∞—Å—Ç–∫–æ–≤—ñ –±–∞–ª–∏ –∑–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏")
    print("‚Ä¢ –®—Ç—Ä–∞—Ñ–∏ –∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ")
    print("‚Ä¢ –ú–æ—Ç–∏–≤–∞—Ü—ñ—è –¥–æ –±—ñ–ª—å—à —Ä–µ—Ç–µ–ª—å–Ω–æ–≥–æ –≤–∏–≤—á–µ–Ω–Ω—è")
    
    print("\n‚ö†Ô∏è  –û–°–û–ë–õ–ò–í–û–°–¢–Ü:")
    print("‚Ä¢ –ü—Ä–æ—Å—Ç—ñ –∑–∞–≤–¥–∞–Ω–Ω—è –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –±—ñ–Ω–∞—Ä–Ω–∏–º–∏ (0 –∞–±–æ –ø–æ–≤–Ω–∏–π –±–∞–ª)")
    print("‚Ä¢ –°–∫–ª–∞–¥–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è (>1 –ª—ñ—Ç–µ—Ä–∏) –æ—Ü—ñ–Ω—é—é—Ç—å—Å—è —á–∞—Å—Ç–∫–æ–≤–æ")
    print("‚Ä¢ –®—Ç—Ä–∞—Ñ: 50% –≤—ñ–¥ –±–∞–∑–æ–≤–æ–≥–æ –±–∞–ª—É –∑–∞ –∫–æ–∂–Ω—É –ø–æ–º–∏–ª–∫—É")
    print("‚Ä¢ –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π –±–∞–ª: 0 (–Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –≤—ñ–¥'—î–º–Ω–∏–º)")
    
    print(f"\nüìÅ –î–µ—Ç–∞–ª—å–Ω—ñ –∑–≤—ñ—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤ –ø–∞–ø—Ü—ñ: {output_dir}")
    print("\n=== –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ ===")

if __name__ == '__main__':
    create_scoring_comparison_demo()